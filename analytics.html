<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analytics RRHH ¬∑ Torneo Mundial 2026</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=Nunito+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --navy:  #2B3990;
  --navy2: #1E2A72;
  --navy5: #131c58;
  --gold:  #F5A623;
  --gold2: #e8951a;
  --white: #FFFFFF;
  --off:   #E8EDF8;
  --muted: #8892BE;
  --green: #2FD37A;
  --red:   #FF5A5A;
  --blue:  #4A9EFF;
  --border: rgba(255,255,255,0.08);
}
* { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior: smooth; }
body {
  background: var(--navy2);
  color: var(--white);
  font-family: "Nunito Sans", sans-serif;
  min-height: 100vh;
  padding: 20px;
}

body::before {
  content:""; position:fixed; inset:0;
  background:
    radial-gradient(ellipse at 5% 20%, rgba(245,166,35,0.06) 0%, transparent 50%),
    radial-gradient(ellipse at 95% 80%, rgba(47,211,122,0.04) 0%, transparent 45%);
  pointer-events:none; z-index:0;
}

/* LOGIN SCREEN */
#loginScreen {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  background: var(--navy2);
}

.login-box {
  max-width: 400px;
  width: 100%;
  background: rgba(43,57,144,0.3);
  backdrop-filter: blur(20px);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 40px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.5);
}

.lock-icon {
  width: 60px;
  height: 60px;
  margin: 0 auto 20px;
  background: var(--gold);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
}

.login-box h1 {
  font-family: "Nunito", sans-serif;
  font-size: 24px;
  font-weight: 900;
  text-align: center;
  margin-bottom: 8px;
}

.login-box .subtitle {
  text-align: center;
  color: var(--muted);
  font-size: 14px;
  margin-bottom: 32px;
}

.login-box input {
  width: 100%;
  padding: 14px 16px;
  background: rgba(19,28,88,0.5);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--white);
  font-family: "Nunito Sans", sans-serif;
  font-size: 14px;
  margin-bottom: 16px;
}

.login-box input:focus {
  outline: none;
  border-color: var(--gold);
  background: rgba(19,28,88,0.8);
}

.login-box button {
  width: 100%;
  padding: 14px;
  background: linear-gradient(135deg, var(--gold) 0%, var(--gold2) 100%);
  border: none;
  border-radius: 8px;
  color: var(--navy5);
  font-family: "Nunito", sans-serif;
  font-size: 16px;
  font-weight: 800;
  cursor: pointer;
  transition: all 0.3s;
}

.login-box button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(245,166,35,0.4);
}

.error-msg {
  color: var(--red);
  font-size: 14px;
  text-align: center;
  margin-top: 12px;
  display: none;
}

.error-msg.show {
  display: block;
}

/* DASHBOARD */
#dashboard {
  display: none;
  position: relative;
  z-index: 1;
  max-width: 1400px;
  margin: 0 auto;
}

.header {
  background: rgba(43,57,144,0.3);
  backdrop-filter: blur(20px);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 24px 32px;
  margin-bottom: 24px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.header h1 {
  font-family: "Nunito", sans-serif;
  font-size: 28px;
  font-weight: 900;
}

.header .subtitle {
  color: var(--muted);
  font-size: 14px;
}

.logout-btn {
  padding: 10px 20px;
  background: rgba(255,90,90,0.2);
  border: 1px solid var(--red);
  border-radius: 8px;
  color: var(--red);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.logout-btn:hover {
  background: rgba(255,90,90,0.3);
}

.metrics-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  margin-bottom: 24px;
}

.metric-card {
  background: rgba(43,57,144,0.3);
  backdrop-filter: blur(20px);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 24px;
  transition: all 0.3s;
}

.metric-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 40px rgba(0,0,0,0.3);
}

.metric-card .icon {
  width: 48px;
  height: 48px;
  background: rgba(245,166,35,0.15);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  margin-bottom: 16px;
}

.metric-card .label {
  font-size: 14px;
  color: var(--muted);
  margin-bottom: 8px;
  font-weight: 600;
}

.metric-card .value {
  font-family: "Nunito", sans-serif;
  font-size: 36px;
  font-weight: 900;
  color: var(--gold);
}

.metric-card .subvalue {
  font-size: 14px;
  color: var(--off);
  margin-top: 4px;
}

.section-card {
  background: rgba(43,57,144,0.3);
  backdrop-filter: blur(20px);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 28px;
  margin-bottom: 24px;
}

.section-card h2 {
  font-family: "Nunito", sans-serif;
  font-size: 20px;
  font-weight: 800;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 12px;
}

.section-card h2 .icon {
  width: 32px;
  height: 32px;
  background: rgba(245,166,35,0.15);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
}

.table {
  width: 100%;
  border-collapse: collapse;
}

.table th {
  text-align: left;
  padding: 12px;
  font-size: 14px;
  font-weight: 700;
  color: var(--muted);
  border-bottom: 1px solid var(--border);
}

.table td {
  padding: 14px 12px;
  font-size: 14px;
  border-bottom: 1px solid rgba(255,255,255,0.05);
}

.table tr:hover {
  background: rgba(255,255,255,0.02);
}

.badge {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 700;
}

.badge.high {
  background: rgba(47,211,122,0.15);
  color: var(--green);
}

.badge.medium {
  background: rgba(245,166,35,0.15);
  color: var(--gold);
}

.badge.low {
  background: rgba(255,90,90,0.15);
  color: var(--red);
}

.loading {
  text-align: center;
  padding: 40px;
  color: var(--muted);
}

.footer {
  text-align: center;
  margin-top: 40px;
  padding: 20px;
  font-size: 12px;
  color: var(--muted);
}
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="loginScreen">
  <div class="login-box">
    <div class="lock-icon">üîê</div>
    <h1>Analytics Dashboard</h1>
    <div class="subtitle">Acceso exclusivo RRHH</div>
    
    <input type="password" id="passwordInput" placeholder="Contrase√±a de acceso" autocomplete="off">
    <button onclick="checkPassword()">Ingresar</button>
    <div class="error-msg" id="errorMsg">‚ùå Contrase√±a incorrecta</div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboard">
  <div class="header">
    <div>
      <h1>üìä Analytics Dashboard</h1>
      <div class="subtitle">M√©tricas de Engagement ¬∑ Torneo Mundial 2026</div>
    </div>
    <button class="logout-btn" onclick="logout()">Cerrar Sesi√≥n</button>
  </div>

  <div class="loading" id="loading">Cargando m√©tricas...</div>

  <div id="content" style="display:none;">
    <!-- M√âTRICAS PRINCIPALES -->
    <div class="metrics-grid">
      <div class="metric-card">
        <div class="icon">üë•</div>
        <div class="label">Participantes Activos</div>
        <div class="value" id="totalParticipantes">-</div>
        <div class="subvalue" id="participacionRate">-</div>
      </div>

      <div class="metric-card">
        <div class="icon">‚öΩ</div>
        <div class="label">Predicciones Totales</div>
        <div class="value" id="totalPredicciones">-</div>
        <div class="subvalue" id="promedioPredicciones">-</div>
      </div>

      <div class="metric-card">
        <div class="icon">üèÜ</div>
        <div class="label">Engagement Rate</div>
        <div class="value" id="engagementRate">-</div>
        <div class="subvalue">√öltima actualizaci√≥n: ahora</div>
      </div>

      <div class="metric-card">
        <div class="icon">üìà</div>
        <div class="label">Top √Årea</div>
        <div class="value" id="topArea" style="font-size: 24px;">-</div>
        <div class="subvalue" id="topAreaPromedio">-</div>
      </div>
    </div>

    <!-- PARTICIPACI√ìN POR √ÅREA -->
    <div class="section-card">
      <h2><span class="icon">üìä</span> Participaci√≥n por √Årea</h2>
      <table class="table">
        <thead>
          <tr>
            <th>√Årea / Sede</th>
            <th>Participantes</th>
            <th>Promedio Puntos</th>
            <th>Engagement</th>
          </tr>
        </thead>
        <tbody id="areaTable">
          <tr><td colspan="4" style="text-align:center; color: var(--muted);">Cargando...</td></tr>
        </tbody>
      </table>
    </div>

    <!-- TOP 10 M√ÅS ACTIVOS -->
    <div class="section-card">
      <h2><span class="icon">üî•</span> Top 10 Participantes M√°s Activos</h2>
      <table class="table">
        <thead>
          <tr>
            <th>#</th>
            <th>Nombre</th>
            <th>√Årea</th>
            <th>Predicciones</th>
            <th>Puntos</th>
          </tr>
        </thead>
        <tbody id="topParticipantesTable">
          <tr><td colspan="5" style="text-align:center; color: var(--muted);">Cargando...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="footer">
    üèÜ Torneo Pron√≥sticos Mundial 2026 ¬∑ Powered by P√°sala Ch√©vere
  </div>
</div>

<script>
// üî• CONFIGURACI√ìN
const ANALYTICS_PASSWORD = 'adminpc';
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwp5Ifwd0TlD2L0Pr80w7168XzSdRHcRTGFRkESMfLgHT-4PNBin6nhTDOoyt5R6vYTDg/exec';

// Login
function checkPassword() {
  const password = document.getElementById('passwordInput').value;
  const errorMsg = document.getElementById('errorMsg');
  
  if (password === ANALYTICS_PASSWORD) {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('dashboard').style.display = 'block';
    loadAnalytics();
  } else {
    errorMsg.classList.add('show');
    setTimeout(() => errorMsg.classList.remove('show'), 3000);
  }
}

// Enter key en password
document.getElementById('passwordInput')?.addEventListener('keypress', (e) => {
  if (e.key === 'Enter') checkPassword();
});

// Logout
function logout() {
  document.getElementById('loginScreen').style.display = 'flex';
  document.getElementById('dashboard').style.display = 'none';
  document.getElementById('passwordInput').value = '';
}

// Cargar analytics
async function loadAnalytics() {
  try {
    const response = await fetch(`${SCRIPT_URL}?action=getAnalytics`);
    const data = await response.json();
    
    if (data.success) {
      renderAnalytics(data.analytics);
    } else {
      alert('Error cargando datos: ' + data.message);
    }
  } catch (error) {
    alert('Error de conexi√≥n: ' + error.message);
  }
}

function renderAnalytics(analytics) {
  document.getElementById('loading').style.display = 'none';
  document.getElementById('content').style.display = 'block';
  
  // M√©tricas principales
  document.getElementById('totalParticipantes').textContent = analytics.totalParticipantes;
  document.getElementById('participacionRate').textContent = `${analytics.participacionRate}% de participaci√≥n`;
  document.getElementById('totalPredicciones').textContent = analytics.totalPredicciones;
  document.getElementById('promedioPredicciones').textContent = `${analytics.promedioPredicciones} predicciones/persona`;
  document.getElementById('engagementRate').textContent = `${analytics.engagementRate}%`;
  document.getElementById('topArea').textContent = analytics.topArea.nombre;
  document.getElementById('topAreaPromedio').textContent = `${analytics.topArea.promedio} pts promedio`;
  
  // Tabla de √°reas
  const areaTable = document.getElementById('areaTable');
  areaTable.innerHTML = '';
  analytics.areas.forEach(area => {
    const engagementClass = area.engagement > 70 ? 'high' : area.engagement > 40 ? 'medium' : 'low';
    areaTable.innerHTML += `
      <tr>
        <td><strong>${area.nombre}</strong></td>
        <td>${area.participantes}</td>
        <td>${area.promedioPuntos} pts</td>
        <td><span class="badge ${engagementClass}">${area.engagement}%</span></td>
      </tr>
    `;
  });
  
  // Top 10 participantes
  const topTable = document.getElementById('topParticipantesTable');
  topTable.innerHTML = '';
  analytics.topParticipantes.forEach((p, i) => {
    topTable.innerHTML += `
      <tr>
        <td><strong>#${i + 1}</strong></td>
        <td>${p.nombre}</td>
        <td>${p.area}</td>
        <td>${p.predicciones}</td>
        <td><strong>${p.puntos}</strong></td>
      </tr>
    `;
  });
}
</script>

</body>
</html>
